Code taken from SDWebImage: https://github.com/rs/SDWebImage
This code is taken unchanged from version 3.7.1
